# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∏ Services

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–∞—Ö `api/` –∏ `services/`, –∏—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–±–æ—Ç—ã.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
api/                    # API endpoints (FastAPI routers)
‚îú‚îÄ‚îÄ auth.py            # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –±–∞–Ω–∫–æ–≤
‚îú‚îÄ‚îÄ accounts.py        # Accounts API (—Å—á–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤)
‚îú‚îÄ‚îÄ consents.py        # Account-Consents API (—Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø)
‚îú‚îÄ‚îÄ payments.py        # Payments API (–ø–ª–∞—Ç–µ–∂–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã)
‚îú‚îÄ‚îÄ payment_consents.py # Payment-Consents API (—Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–ª–∞—Ç–µ–∂–∏)
‚îú‚îÄ‚îÄ products.py        # Products API (–∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤)
‚îú‚îÄ‚îÄ product_agreements.py # ProductAgreements API (–¥–æ–≥–æ–≤–æ—Ä—ã)
‚îú‚îÄ‚îÄ product_agreement_consents.py # –°–æ–≥–ª–∞—Å–∏—è –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ product_offers.py  # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ product_offer_consents.py # –°–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ product_applications.py # –ó–∞—è–≤–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã
‚îú‚îÄ‚îÄ multibank_proxy.py # Multibank API (–∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤)
‚îú‚îÄ‚îÄ interbank.py       # –ú–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
‚îú‚îÄ‚îÄ banker.py          # Banker API (–∫–∞–±–∏–Ω–µ—Ç –±–∞–Ω–∫–∏—Ä–∞)
‚îú‚îÄ‚îÄ admin.py           # Admin API (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
‚îú‚îÄ‚îÄ customer_leads.py  # Customer Leads API
‚îú‚îÄ‚îÄ vrp_consents.py    # VRP Consents API (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–ª–∞—Ç–µ–∂–∏)
‚îú‚îÄ‚îÄ vrp_payments.py    # VRP Payments API
‚îî‚îÄ‚îÄ well_known.py      # JWKS endpoint (–ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏)

services/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Å–µ—Ä–≤–∏—Å—ã)
‚îú‚îÄ‚îÄ auth_service.py    # –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT, RS256)
‚îú‚îÄ‚îÄ consent_service.py # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è–º–∏
‚îî‚îÄ‚îÄ payment_service.py # –°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
```

---

## üîê API: Auth (`api/auth.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –±–∞–Ω–∫–æ–≤ –∏ –∫–æ–º–∞–Ω–¥.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /auth/login`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –±–∞–Ω–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `username` (person_id –∫–ª–∏–µ–Ω—Ç–∞), `password`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JWT —Ç–æ–∫–µ–Ω (HS256), –≤–∞–ª–∏–¥–µ–Ω 24 —á–∞—Å–∞
- **–õ–æ–≥–∏–∫–∞:**
  - –ò—â–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ `person_id`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–æ–ª—å (–¥–ª—è demo-–∫–ª–∏–µ–Ω—Ç–æ–≤: "password", –¥–ª—è team-–∫–ª–∏–µ–Ω—Ç–æ–≤: –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `teams`)
  - –°–æ–∑–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω —Å —Ç–∏–ø–æ–º "client"
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`

#### 2. `POST /auth/bank-token`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `client_id` (ID –∫–æ–º–∞–Ω–¥—ã), `client_secret` (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JWT —Ç–æ–∫–µ–Ω (RS256) –¥–ª—è –±–∞–Ω–∫–∞
- **–õ–æ–≥–∏–∫–∞:**
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç credentials –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `teams`
  - –°–æ–∑–¥–∞–µ—Ç RS256 —Ç–æ–∫–µ–Ω (–¥–ª—è —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
  - –¢–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç: `sub` (client_id), `type: "team"`, `iss` (BANK_CODE)

#### 3. `POST /auth/banker-login`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–∞–Ω–∫–∏—Ä–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–∞–Ω–∫–∞)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `username`, `password`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JWT —Ç–æ–∫–µ–Ω –¥–ª—è –±–∞–Ω–∫–∏—Ä–∞
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Banker UI

#### 4. `GET /auth/me`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞

#### 5. `POST /auth/register-team`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã –≤ —Å–∏—Å—Ç–µ–º–µ
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `client_id`, `client_secret`, `team_name`
- **–õ–æ–≥–∏–∫–∞:** –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `teams`

---

## üí∞ API: Accounts (`api/accounts.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (OpenBanking Russia v2.1).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /accounts`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 
  - `client_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  - `x-consent-id` (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  - `x-requesting-bank` (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –∫–æ–¥ –±–∞–Ω–∫–∞-–∑–∞–ø—Ä–æ—Å–∏–≤—à–µ–≥–æ)
- **–õ–æ–≥–∏–∫–∞:**
  - –ï—Å–ª–∏ `x-requesting-bank` —É–∫–∞–∑–∞–Ω ‚Üí –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ —á–µ—Ä–µ–∑ `ConsentService.check_consent()`
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∑–∞–ø—Ä–æ—Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenBanking Russia

#### 2. `GET /accounts/{account_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—á–µ—Ç–µ
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `account_id` (—Ñ–æ—Ä–º–∞—Ç: `acc-{id}`)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ —Å—á–µ—Ç–∞, –±–∞–ª–∞–Ω—Å, —Å—Ç–∞—Ç—É—Å

#### 3. `GET /accounts/{account_id}/balances`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `account_id`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ë–∞–ª–∞–Ω—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenBanking Russia
- **–õ–æ–≥–∏–∫–∞:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ –¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### 4. `GET /accounts/{account_id}/transactions`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Å—á–µ—Ç—É
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `account_id`, `from`, `to` (–¥–∞—Ç—ã)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

#### 5. `POST /accounts`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `account_type`, `currency`, `name`
- **–õ–æ–≥–∏–∫–∞:** 
  - –°–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç –≤ –ë–î
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å = 0

#### 6. `PUT /accounts/{account_id}/close`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–∫—Ä—ã—Ç–∏–µ —Å—á–µ—Ç–∞
- **–õ–æ–≥–∏–∫–∞:** –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞ –Ω–∞ "closed"

---

## ü§ù API: Consents (`api/consents.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º (OpenBanking Russia v2.1).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /account-consents/request`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `client_id`, `permissions`, `reason`, `requesting_bank`
- **–õ–æ–≥–∏–∫–∞:**
  - –í—ã–∑—ã–≤–∞–µ—Ç `ConsentService.create_consent_request()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É `auto_approve_consents`:
    - –ï—Å–ª–∏ `true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ
    - –ï—Å–ª–∏ `false` ‚Üí —Å–æ–∑–¥–∞–µ—Ç pending –∑–∞–ø—Ä–æ—Å, —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `request_id` –∏–ª–∏ `consent_id` (–µ—Å–ª–∏ –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–æ)

#### 2. `POST /account-consents`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π OpenBanking —Ñ–æ—Ä–º–∞—Ç)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `data.permissions`, `data.expirationDateTime`
- **–õ–æ–≥–∏–∫–∞:** –°–æ–∑–¥–∞–µ—Ç consent resource (–ê–§–¢ - Authorization Flow Token)

#### 3. `POST /account-consents/{consent_id}/authorize`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–∏—è (OAuth flow)
- **–õ–æ–≥–∏–∫–∞:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ

#### 4. `POST /account-consents/sign`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π endpoint)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `request_id`, `action` ("approve" / "reject"), `signature`
- **–õ–æ–≥–∏–∫–∞:**
  - –í—ã–∑—ã–≤–∞–µ—Ç `ConsentService.sign_consent()`
  - –ï—Å–ª–∏ `action = "approve"` ‚Üí —Å–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ
  - –ï—Å–ª–∏ `action = "reject"` ‚Üí –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å

#### 5. `GET /account-consents/my-consents`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–≥–ª–∞—Å–∏–π —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–∏–π

#### 6. `GET /account-consents/requests`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ pending –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–¥–æ–±—Ä–µ–Ω–∏—è

#### 7. `GET /account-consents/{consent_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–≥–ª–∞—Å–∏–∏
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ —Å–æ–≥–ª–∞—Å–∏—è, —Å—Ç–∞—Ç—É—Å, permissions

#### 8. `DELETE /account-consents/{consent_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è
- **–õ–æ–≥–∏–∫–∞:** –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ "Revoked"

---

## üí∏ API: Payments (`api/payments.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (OpenBanking Russia Payments API).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /payments`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (—Ä–∞–∑–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 
  - `data.initiation.instructedAmount` (—Å—É–º–º–∞)
  - `data.initiation.debtorAccount` (—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
  - `data.initiation.creditorAccount` (—Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
  - `x-payment-consent-id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π —Å —Å–æ–≥–ª–∞—Å–∏–µ–º)
- **–õ–æ–≥–∏–∫–∞:**
  - –í—ã–∑—ã–≤–∞–µ—Ç `PaymentService.initiate_payment()`
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø–ª–∞—Ç–µ–∂–∞:
    - **–í–Ω—É—Ç—Ä–∏–±–∞–Ω–∫–æ–≤—Å–∫–∏–π:** —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ —Ç–æ–º –∂–µ –±–∞–Ω–∫–µ ‚Üí —Å—Ä–∞–∑—É –∑–∞—á–∏—Å–ª—è–µ—Ç
    - **–ú–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–π:** —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –¥—Ä—É–≥–æ–º –±–∞–Ω–∫–µ ‚Üí —Å–æ–∑–¥–∞–µ—Ç `InterbankTransfer`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–≥–æ–π –±–∞–Ω–∫
  - –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  - –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Debit –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, Credit –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `payment_id` –∏ —Å—Ç–∞—Ç—É—Å

#### 2. `GET /payments/{payment_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞, —Å—Ç–∞—Ç—É—Å, –¥–∞—Ç—ã

---

## üí≥ API: Payment Consents (`api/payment_consents.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è–º–∏ –Ω–∞ –ø–ª–∞—Ç–µ–∂–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /payment-consents/request`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `data.initiation` (–¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞)
- **–õ–æ–≥–∏–∫–∞:**
  - –°–æ–∑–¥–∞–µ—Ç `PaymentConsentRequest` –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `auto_approve_payment_consents`:
    - –ï—Å–ª–∏ `true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ
    - –ï—Å–ª–∏ `false` ‚Üí —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è –±–∞–Ω–∫–∏—Ä–æ–º

#### 2. `GET /payment-consents/{consent_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–≥–ª–∞—Å–∏–∏ –Ω–∞ –ø–ª–∞—Ç–µ–∂
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ —Å–æ–≥–ª–∞—Å–∏—è, —Å—Ç–∞—Ç—É—Å, –¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞

#### 3. `POST /payment-consents/{request_id}/approve`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–¥–æ–±—Ä–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–ª–∞—Ç–µ–∂ (–±–∞–Ω–∫–∏—Ä–æ–º)
- **–õ–æ–≥–∏–∫–∞:** –°–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ `PaymentConsent`

#### 4. `DELETE /payment-consents/{consent_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–ª–∞—Ç–µ–∂

---

## üè¶ API: Products (`api/products.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞ (OpenBanking Russia Products API v1.3).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /products`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `product_type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: "deposit", "loan", "card")
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å —Å—Ç–∞–≤–∫–∞–º–∏, –ª–∏–º–∏—Ç–∞–º–∏, —É—Å–ª–æ–≤–∏—è–º–∏

#### 2. `GET /products/{product_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥—É–∫—Ç–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞, –æ–ø–∏—Å–∞–Ω–∏–µ, —É—Å–ª–æ–≤–∏—è

---

## üìù API: Product Agreements (`api/product_agreements.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–≥–æ–≤–æ—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (–¥–µ–ø–æ–∑–∏—Ç—ã, –∫—Ä–µ–¥–∏—Ç—ã, –∫–∞—Ä—Ç—ã).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /product-agreements`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏

#### 2. `POST /product-agreements`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `product_id`, `amount`, `term_months`, `source_account_id`
- **–õ–æ–≥–∏–∫–∞:**
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ (–º–∏–Ω/–º–∞–∫—Å —Å—É–º–º–∞, —Å—Ä–æ–∫)
  - –î–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞: —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–∞, —Å–æ–∑–¥–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç–Ω—ã–π —Å—á–µ—Ç
  - –î–ª—è –∫—Ä–µ–¥–∏—Ç–∞: –≤—ã–¥–∞–µ—Ç –∫—Ä–µ–¥–∏—Ç, —Å–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç –¥–ª—è –ø–æ–≥–∞—à–µ–Ω–∏—è
  - –î–ª—è –∫–∞—Ä—Ç—ã: —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–Ω—ã–π —Å—á–µ—Ç
  - –°–æ–∑–¥–∞–µ—Ç `ProductAgreement` –≤ –ë–î
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –±–∞–Ω–∫–∞ (`BankCapital`)

#### 3. `GET /product-agreements/{agreement_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ–≥–æ–≤–æ—Ä–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –î–µ—Ç–∞–ª–∏ –¥–æ–≥–æ–≤–æ—Ä–∞, —Å—Ç–∞—Ç—É—Å, –¥–∞—Ç—ã

#### 4. `DELETE /product-agreements/{agreement_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (–¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞/–∫—Ä–µ–¥–∏—Ç–∞)
- **–õ–æ–≥–∏–∫–∞:** 
  - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ (–¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞) –∏–ª–∏ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ (–¥–ª—è –∫—Ä–µ–¥–∏—Ç–∞)
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –±–∞–Ω–∫–∞

---

## üîÑ API: Multibank Proxy (`api/multibank_proxy.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤ –∏–∑ –¥—Ä—É–≥–∏—Ö –±–∞–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ OpenBanking –ø—Ä–æ—Ç–æ–∫–æ–ª.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /multibank/bank-token`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `bank_url` (URL —Ü–µ–ª–µ–≤–æ–≥–æ –±–∞–Ω–∫–∞)
- **–õ–æ–≥–∏–∫–∞:**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `TEAM_CLIENT_ID` –∏ `TEAM_CLIENT_SECRET` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
  - –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `{bank_url}/auth/bank-token`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### 2. `POST /multibank/request-consent`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–ø—Ä–æ—Å —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —Å—á–µ—Ç–∞–º –∫–ª–∏–µ–Ω—Ç–∞ –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `bank_url`, `bank_token`, `client_id`
- **–õ–æ–≥–∏–∫–∞:**
  - –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `{bank_url}/account-consents/request`
  - –ü–µ—Ä–µ–¥–∞–µ—Ç `x-requesting-bank: {TEAM_CLIENT_ID}`
  - **–î–ª—è SBank:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è:
    - –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ `/auth/login`
    - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ —á–µ—Ä–µ–∑ `/account-consents/sign`
    - –ò–∑–≤–ª–µ–∫–∞–µ—Ç `consent_id` –∏–∑ –æ—Ç–≤–µ—Ç–∞
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `consent_id` –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### 3. `POST /multibank/accounts-with-consent`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º consent
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `bank_url`, `bank_token`, `consent_id`, `client_id`
- **–õ–æ–≥–∏–∫–∞:**
  - –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `{bank_url}/accounts?client_id={client_id}`
  - –ü–µ—Ä–µ–¥–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏: `Authorization: Bearer {bank_token}`, `x-consent-id: {consent_id}`, `x-requesting-bank: {TEAM_CLIENT_ID}`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenBanking Russia

#### 4. `POST /multibank/balances-with-consent`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º consent
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `account_id`, `bank_url`, `bank_token`, `consent_id` (query params)
- **–õ–æ–≥–∏–∫–∞:**
  - –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `{bank_url}/accounts/{account_id}/balances`
  - –ü–µ—Ä–µ–¥–∞–µ—Ç —Ç–µ –∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —á—Ç–æ –∏ –≤ `accounts-with-consent`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞

### OpenBanking Flow –¥–ª—è Multibank:

```
1. Bank Token      ‚Üí POST /multibank/bank-token
   ‚Üì
2. Request Consent ‚Üí POST /multibank/request-consent
   ‚Üì
3. Get Accounts    ‚Üí POST /multibank/accounts-with-consent
   ‚Üì
4. Get Balances    ‚Üí POST /multibank/balances-with-consent
```

---

## üèõÔ∏è API: Banker (`api/banker.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–∞–±–∏–Ω–µ—Ç –±–∞–Ω–∫–∏—Ä–∞ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫–æ–º).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /banker/clients`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∞–Ω–∫–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∏—Ö –¥–∞–Ω–Ω—ã–º–∏

#### 2. `GET /banker/products`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–∞–Ω–∫–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–æ —Å—Ç–∞–≤–∫–∞–º–∏ –∏ –ª–∏–º–∏—Ç–∞–º–∏

#### 3. `PUT /banker/products/{product_id}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (—Å—Ç–∞–≤–∫–∏, –ª–∏–º–∏—Ç—ã)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `interest_rate`, `min_amount`, `max_amount`, `is_active`
- **–õ–æ–≥–∏–∫–∞:** –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –≤ –ë–î

#### 4. `POST /banker/products`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `product_id`, `product_type`, `name`, `interest_rate`, etc.

#### 5. `GET /banker/consents/pending`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ pending –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏—è
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–¥–æ–±—Ä–µ–Ω–∏—è

#### 6. `PUT /banker/consents/{request_id}/approve`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ
- **–õ–æ–≥–∏–∫–∞:** –°–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ

#### 7. `PUT /banker/consents/{request_id}/reject`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ
- **–õ–æ–≥–∏–∫–∞:** –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ "rejected"

---

## üìä API: Admin (`api/admin.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–Ω–∫–∞ (–¥–ª—è –µ-–ö–∞—Ç–∞–ª–æ–≥–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /admin/capital`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞ –±–∞–Ω–∫–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ö–∞–ø–∏—Ç–∞–ª, –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –¥–µ–ø–æ–∑–∏—Ç—ã, –∫—Ä–µ–¥–∏—Ç—ã
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –µ-–ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 2. `GET /admin/stats`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–∞–Ω–∫–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç–æ–≤, –ø–ª–∞—Ç–µ–∂–µ–π, –±–∞–ª–∞–Ω—Å, –∫–ª–∏–µ–Ω—Ç–æ–≤

#### 3. `GET /admin/transfers`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

#### 4. `GET /admin/payments`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π —Å –¥–µ—Ç–∞–ª—è–º–∏

#### 5. `GET /admin/key-rate`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ –¶–ë
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°—Ç–∞–≤–∫–∞, –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### 6. `GET /admin/key-rate/history`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –¥–∞—Ç–∞–º–∏

#### 7. `GET /admin/banks/{bank_code}/settings`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–∞–Ω–∫–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏–π, etc.

#### 8. `PUT /admin/banks/{bank_code}/settings`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–∞–Ω–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `auto_approve_consents`, etc.

#### 9. `GET /admin/teams`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

---

## üîë API: Well Known (`api/well_known.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è RS256 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWKS).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `GET /.well-known/jwks.json`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π –±–∞–Ω–∫–∞ (JWKS)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON Web Key Set –≤ —Ñ–æ—Ä–º–∞—Ç–µ JWKS
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –î—Ä—É–≥–∏–º–∏ –±–∞–Ω–∫–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ RS256 —Ç–æ–∫–µ–Ω–æ–≤
- **–õ–æ–≥–∏–∫–∞:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π RSA –∫–ª—é—á –∏–∑ `shared/keys/{BANK_CODE}_public.pem` –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç JWKS

---

## üåê API: Interbank (`api/interbank.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã (–ø—Ä–∏–µ–º –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –æ—Ç –¥—Ä—É–≥–∏—Ö –±–∞–Ω–∫–æ–≤).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `POST /interbank/receive`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–∏–µ–º –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `from_bank`, `to_account_number`, `amount`, `transfer_id`
- **–õ–æ–≥–∏–∫–∞:**
  - –ò—â–µ—Ç —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ —Å–≤–æ–µ–º –±–∞–Ω–∫–µ
  - –ï—Å–ª–∏ —Å—á–µ—Ç –Ω–∞–π–¥–µ–Ω ‚Üí –∑–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞, —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
  - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `InterbankTransfer` –≤ —Å—Ç–∞—Ç—É—Å–µ "completed"
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –±–∞–Ω–∫–∞
  - –ï—Å–ª–∏ —Å—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

#### 2. `GET /interbank/check-account/{account_number}`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç–∞ (–¥–ª—è –¥—Ä—É–≥–∏—Ö –±–∞–Ω–∫–æ–≤)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—á–µ—Ç–µ (–±–µ–∑ –±–∞–ª–∞–Ω—Å–∞, –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

#### 3. `GET /interbank/transfers`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

---

## üéØ API: –î—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏

### `api/product_offers.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, —É–¥–∞–ª–µ–Ω–∏–µ

### `api/product_offer_consents.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ—Ç–∑—ã–≤

### `api/product_applications.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—è–≤–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ

### `api/product_agreement_consents.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–∏—è –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞–º–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–∏—è, –æ–¥–æ–±—Ä–µ–Ω–∏–µ, –æ—Ç–∑—ã–≤

### `api/customer_leads.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ

### `api/vrp_consents.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–ª–∞—Ç–µ–∂–∏ (VRP)
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ VRP —Å–æ–≥–ª–∞—Å–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ—Ç–∑—ã–≤

### `api/vrp_payments.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–ª–∞—Ç–µ–∂–∏ (VRP)
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ VRP –ø–ª–∞—Ç–µ–∂–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

---

## ‚öôÔ∏è Services: Auth Service (`services/auth_service.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT, RS256, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `create_access_token(data, expires_delta, use_rs256)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `data` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ (sub, type, etc.)
  - `expires_delta` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
  - `use_rs256` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RS256 (–¥–ª—è –±–∞–Ω–∫–æ–≤) –∏–ª–∏ HS256 (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
- **–õ–æ–≥–∏–∫–∞:**
  - –ï—Å–ª–∏ `use_rs256 = True` ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π RSA –∫–ª—é—á –∏–∑ `shared/keys/{BANK_CODE}_private.pem`, —Å–æ–∑–¥–∞–µ—Ç RS256 —Ç–æ–∫–µ–Ω
  - –ï—Å–ª–∏ `use_rs256 = False` ‚Üí —Å–æ–∑–¥–∞–µ—Ç HS256 —Ç–æ–∫–µ–Ω —Å `SECRET_KEY`
  - –î–æ–±–∞–≤–ª—è–µ—Ç `exp` (expiration time) –≤ payload
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω

#### 2. `verify_token(token, bank_code)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `token` - JWT —Ç–æ–∫–µ–Ω, `bank_code` - –∫–æ–¥ –±–∞–Ω–∫–∞ (–¥–ª—è RS256)
- **–õ–æ–≥–∏–∫–∞:**
  - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫ HS256 —Ç–æ–∫–µ–Ω
  - –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏ —É–∫–∞–∑–∞–Ω `bank_code` ‚Üí –ø—Ä–æ–±—É–µ—Ç RS256 —á–µ—Ä–µ–∑ `verify_rs256_token()`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç payload —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

#### 3. `verify_rs256_token(token, bank_code)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ RS256 —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ JWKS
- **–õ–æ–≥–∏–∫–∞:**
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π RSA –∫–ª—é—á –∏–∑ `shared/keys/{bank_code}_public.pem`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω —Å –ø–æ–º–æ—â—å—é –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç payload

#### 4. `get_current_client(credentials, db)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (Dependency –¥–ª—è FastAPI)
- **–õ–æ–≥–∏–∫–∞:**
  - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer <token>`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `verify_token()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ = "client"
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Ç–æ–∫–µ–Ω–∞

#### 5. `get_current_banker(credentials, db)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–∏—Ä–∞ (Dependency)
- **–õ–æ–≥–∏–∫–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `get_current_client()`, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø "banker"

#### 6. `get_optional_client(credentials, db)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- **–õ–æ–≥–∏–∫–∞:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –∏–Ω–∞—á–µ `None`

---

## ü§ù Services: Consent Service (`services/consent_service.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (OpenBanking Russia Account-Consents API v2.1).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `check_consent(db, client_person_id, requesting_bank, permissions)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `client_person_id` - ID –∫–ª–∏–µ–Ω—Ç–∞
  - `requesting_bank` - –∫–æ–¥ –±–∞–Ω–∫–∞, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –¥–æ—Å—Ç—É–ø
  - `permissions` - —Ç—Ä–µ–±—É–µ–º—ã–µ permissions (–Ω–∞–ø—Ä–∏–º–µ—Ä, ["ReadAccountsDetail"])
- **–õ–æ–≥–∏–∫–∞:**
  - –ò—â–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ `person_id`
  - –ò—â–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å:
    - `client_id` = –∫–ª–∏–µ–Ω—Ç
    - `granted_to` = requesting_bank
    - `status` = "active"
    - `expiration_date_time` > —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ permissions –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
  - –û–±–Ω–æ–≤–ª—è–µ—Ç `last_accessed_at`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Consent` –∏–ª–∏ `None`

#### 2. `create_consent_request(db, client_person_id, requesting_bank, requesting_bank_name, permissions, reason)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `client_person_id` - ID –∫–ª–∏–µ–Ω—Ç–∞
  - `requesting_bank` - –∫–æ–¥ –±–∞–Ω–∫–∞-–∑–∞–ø—Ä–æ—Å–∏–≤—à–µ–≥–æ
  - `requesting_bank_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞
  - `permissions` - —Å–ø–∏—Å–æ–∫ permissions
  - `reason` - –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞
- **–õ–æ–≥–∏–∫–∞:**
  - –°–æ–∑–¥–∞–µ—Ç `ConsentRequest` –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É `auto_approve_consents`:
    - –ï—Å–ª–∏ `true` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(request, consent)`
    - –ï—Å–ª–∏ `false` ‚Üí —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(request, None)`
  - –°–æ–∑–¥–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–æ)

#### 3. `sign_consent(db, request_id, client_person_id, action, signature)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `request_id` - ID –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ
  - `client_person_id` - ID –∫–ª–∏–µ–Ω—Ç–∞
  - `action` - "approve" –∏–ª–∏ "reject"
  - `signature` - –ø–æ–¥–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ (–ø–∞—Ä–æ–ª—å)
- **–õ–æ–≥–∏–∫–∞:**
  - –ù–∞—Ö–æ–¥–∏—Ç `ConsentRequest` –ø–æ ID
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
  - –ï—Å–ª–∏ `action = "approve"`:
    - –°–æ–∑–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ (`Consent`)
    - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `consent_id`
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `status = "active"`
    - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ "approved"
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `("approved", consent)`
  - –ï—Å–ª–∏ `action = "reject"`:
    - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ "rejected"
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `("rejected", None)`

#### 4. `authorize_consent_by_id(db, consent_id, client_person_id, action)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–∏—è –ø–æ ID (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥)
- **–õ–æ–≥–∏–∫–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `sign_consent()`, –Ω–æ –∏—â–µ—Ç –ø–æ `consent_id` –≤–º–µ—Å—Ç–æ `request_id`

#### 5. `revoke_consent(db, consent_id, client_person_id)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∑—ã–≤ —Å–æ–≥–ª–∞—Å–∏—è
- **–õ–æ–≥–∏–∫–∞:**
  - –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ
  - –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "Revoked"
  - –û–±–Ω–æ–≤–ª—è–µ—Ç `status_update_date_time`

---

## üí∏ Services: Payment Service (`services/payment_service.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. `initiate_payment(db, from_account_number, to_account_number, amount, description, payment_consent_id)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `from_account_number` - –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  - `to_account_number` - –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
  - `amount` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
  - `description` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
  - `payment_consent_id` - ID —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–ª–∞—Ç–µ–∂ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–õ–æ–≥–∏–∫–∞:**
  - –ù–∞—Ö–æ–¥–∏—Ç —Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤
  - –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  - –ü—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ —Å–≤–æ–µ–º –±–∞–Ω–∫–µ:
    - **–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω (–≤–Ω—É—Ç—Ä–∏–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥):**
      - –ó–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è
      - –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Debit –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, Credit –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
      - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ = "AcceptedSettlementCompleted"
    - **–ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω (–º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥):**
      - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–Ω–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —Å—á–µ—Ç–∞
      - –°–æ–∑–¥–∞–µ—Ç `InterbankTransfer` –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
      - –í—ã–∑—ã–≤–∞–µ—Ç `send_interbank_transfer()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –¥—Ä—É–≥–æ–π –±–∞–Ω–∫
  - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `Payment` –≤ –ë–î
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –±–∞–Ω–∫–∞ (–¥–ª—è –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(Payment, InterbankTransfer –∏–ª–∏ None)`

#### 2. `send_interbank_transfer(db, transfer, to_bank_code)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –¥—Ä—É–≥–æ–π –±–∞–Ω–∫
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `transfer` - –æ–±—ä–µ–∫—Ç `InterbankTransfer`
  - `to_bank_code` - –∫–æ–¥ –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- **–õ–æ–≥–∏–∫–∞:**
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL –±–∞–Ω–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ –ø–æ –∫–æ–¥—É)
  - –î–µ–ª–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å –∫ `{bank_url}/interbank/receive`
  - –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥–∞ (from_bank, to_account_number, amount, transfer_id)
  - –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ "completed"
  - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "failed"
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –±–∞–Ω–∫–∞

#### 3. `determine_bank_code(account_number)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –±–∞–Ω–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Å—á–µ—Ç–∞
- **–õ–æ–≥–∏–∫–∞:** 
  - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ –±–∞–Ω–∫–∞ (vbank, abank, sbank) –∏–ª–∏ None

---

## üîÑ –ö–∞–∫ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ

### –ü—Ä–∏–º–µ—Ä: –ú–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Å—á–µ—Ç–æ–≤

1. **–ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—á–µ—Ç–∞ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞ —á–µ—Ä–µ–∑ UI**
   - Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /multibank/bank-token` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω
   - Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /multibank/request-consent` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç consent_id
   - Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /multibank/accounts-with-consent` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Å—á–µ—Ç–∞

2. **Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**
   - `multibank_proxy.py` ‚Üí –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–æ–º—É –±–∞–Ω–∫—É
   - –î—Ä—É–≥–æ–π –±–∞–Ω–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ —á–µ—Ä–µ–∑ `ConsentService.check_consent()`
   - –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ –∞–∫—Ç–∏–≤–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—á–µ—Ç–∞
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É "CONSENT_REQUIRED"

### –ü—Ä–∏–º–µ—Ä: –í–Ω—É—Ç—Ä–∏–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–ª–∞—Ç–µ–∂

1. **–ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂**
   - Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /payments` —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞
   - `payments.py` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `PaymentService.initiate_payment()`

2. **PaymentService –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤
   - –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
   - –ù–∞—Ö–æ–¥–∏—Ç —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è ‚Üí –∑–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞
   - –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Payment` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "AcceptedSettlementCompleted"

### –ü—Ä–∏–º–µ—Ä: –ú–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–ª–∞—Ç–µ–∂

1. **–ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –Ω–∞ —Å—á–µ—Ç –¥—Ä—É–≥–æ–≥–æ –±–∞–Ω–∫–∞**
   - Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `POST /payments`
   - `payments.py` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `PaymentService.initiate_payment()`

2. **PaymentService –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤
   - –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–æ —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
   - –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å—á–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ —Å–≤–æ–µ–º –±–∞–Ω–∫–µ
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–Ω–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è ‚Üí —Å–æ–∑–¥–∞–µ—Ç `InterbankTransfer`
   - –í—ã–∑—ã–≤–∞–µ—Ç `send_interbank_transfer()` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–≥–æ–π –±–∞–Ω–∫
   - –î—Ä—É–≥–æ–π –±–∞–Ω–∫ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `POST /interbank/receive`
   - –î—Ä—É–≥–æ–π –±–∞–Ω–∫ –∑–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- **–í—Å–µ API endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç async/await** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç SQLAlchemy ORM** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** JWT —Ç–æ–∫–µ–Ω—ã (HS256 –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, RS256 –¥–ª—è –±–∞–Ω–∫–æ–≤)
- **–°–æ–≥–ª–∞—Å–∏—è:** –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –º–µ–∂–±–∞–Ω–∫–æ–≤—Å–∫–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –≤–∞–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HTTPException

---

## üéØ –†–µ–∑—é–º–µ

- **API (`api/`):** FastAPI routers, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–∑—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å—ã
- **Services (`services/`):** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞ —Å –ë–î, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:** API ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, Services ‚Üí –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **OpenBanking Russia:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ API —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenBanking Russia v2.1

