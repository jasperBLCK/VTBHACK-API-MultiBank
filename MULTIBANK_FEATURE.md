# Функция загрузки счетов из других банков (Multibank)

## Описание

Добавлена возможность загрузки счетов из других банков (VBank, ABank, SBank) через OpenBanking API в FrontendN.

## Как это работает

1. **Получение банковского токена** - используется `TEAM_CLIENT_ID` и `TEAM_CLIENT_SECRET` из конфига
2. **Запрос согласия (consent)** - система пробует получить consent для разных client_id (team251-1 до team251-10)
3. **Загрузка счетов** - получает счета используя consent
4. **Загрузка балансов** - получает балансы для каждого счета

## Использование

### В интерфейсе

1. Войдите в систему как `team251-1`
2. Прокрутите вниз до секции "Счета из других банков"
3. Нажмите "Обновить" для загрузки всех банков
4. Или нажмите на кнопку конкретного банка для загрузки только его счетов

### API Endpoints

Все запросы проксируются через Next.js API routes:

- `POST /api/multibank/bank-token` - получение банковского токена
- `POST /api/multibank/request-consent` - запрос согласия
- `POST /api/multibank/accounts-with-consent` - получение счетов
- `POST /api/multibank/balances-with-consent` - получение балансов

## Банки

- **VBank** (Virtual Bank) - https://vbank.open.bankingapi.ru
- **ABank** (Awesome Bank) - https://abank.open.bankingapi.ru
- **SBank** (Smart Bank) - https://sbank.open.bankingapi.ru

## Логика поиска client_id

Система автоматически пробует разные client_id для получения consent:

1. Сначала пробует текущего пользователя (например, team251-1)
2. Затем пробует других клиентов из той же команды (team251-2, team251-3, ... team251-10)
3. Использует первый client_id, для которого удалось получить consent

## Особенности

- Счета отображаются в отдельной секции под основными счетами
- Показывается общий баланс всех банков
- Каждый банк отображается в отдельном блоке с цветовой индикацией
- Можно загружать счета из каждого банка отдельно или все сразу
- При ошибках показываются понятные сообщения

## Устранение проблем

### Счета не загружаются

1. Убедитесь что backend запущен
2. Проверьте что банки доступны (песочницы должны быть доступны)
3. Проверьте что у команды team251 есть доступ к песочницам
4. Проверьте логи в консоли браузера

### Ошибка "Требуется авторизация согласия"

Это нормально - некоторые банки требуют ручной авторизации согласия на их сайте.

### Ошибка "Не удалось получить согласие"

Система пробует разные client_id автоматически. Если ни один не работает, проверьте что в банках есть тестовые клиенты team251-1 до team251-10.

